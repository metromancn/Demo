@using System.Web
@{
    // 当前语言 —— 控制器可用 ViewBag 传，也可以从 cookie 兜底
    var cookie = Request.Cookies["lang"]?.Value ?? "";
    var lang = (ViewBag.Lang as string ?? cookie ?? "zh").ToLower();   // zh / en / ja / zh-hant

    string Label(string l)
    {
        switch (l)
        {
            case "en": return "EN";
            case "ja": return "日本語";
            case "zh-hant": return "繁體";
            default: return "简体";
        }
    }
}

<!DOCTYPE html>
<html lang="@((lang=="zh")?"zh-CN":(lang=="zh-hant"?"zh-Hant":lang))">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>@ViewBag.Title - MetroMan</title>

    <link rel="stylesheet" href="~/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/assets/css/site.css" />

    @RenderSection("HeadExtra", required: false)
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg bg-light border-bottom">
            <div class="container">
                <!-- ──品牌── -->
                <a class="navbar-brand d-flex align-items-center" href="~/">
                    <img src="@Url.Content("~/assets/img/brand/metroman.png")"
                         width="28" height="28" alt="MetroMan 地铁通">
                    <span class="ms-2 fw-bold d-none d-lg-inline">
                        MetroMan <small class="text-muted">· 地铁通</small>
                    </span>
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#mainNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div id="mainNav" class="collapse navbar-collapse">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link" href="~/en/app">APP</a></li>
                        <li class="nav-item"><a class="nav-link" href="~/en/cities">CITIES</a></li>
                        <li class="nav-item"><a class="nav-link" href="~/en/metro-rankings">RANKINGS</a></li>
                        <li class="nav-item"><a class="nav-link" href="~/en/ask-ai">ASK AI</a></li>
                        <li class="nav-item"><a class="nav-link" href="~/updates">UPDATES</a></li>
                    </ul>

                    <!-- ──语言下拉── -->
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="langDrop"
                               role="button" data-bs-toggle="dropdown">@Label(lang)</a>

                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="langDrop">
                                <li>
                                    <a class="dropdown-item @(lang=="zh"?"active":"")"
                                       href="@Url.Action("SetLang","Lang",
                                           new { to="zh", @return = Request.RawUrl })">简体</a>
                                </li>
                                <li>
                                    <a class="dropdown-item @(lang=="zh-hant"?"active":"")"
                                       href="@Url.Action("SetLang","Lang",
                                           new { to="zh-hant", @return = Request.RawUrl })">繁體</a>
                                </li>
                                <li>
                                    <a class="dropdown-item @(lang=="en"?"active":"")"
                                       href="@Url.Action("SetLang","Lang",
                                           new { to="en", @return = Request.RawUrl })">EN</a>
                                </li>
                                <li>
                                    <a class="dropdown-item @(lang=="ja"?"active":"")"
                                       href="@Url.Action("SetLang","Lang",
                                           new { to="ja", @return = Request.RawUrl })">日本語</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container my-4">
        @RenderBody()
    </main>

    <footer class="text-center text-muted py-4 border-top">
        © 2025 MetroMan   京ICP备17009405号‑1
    </footer>

    <script src="~/assets/js/bootstrap.bundle.min.js"></script>
    <script src="~/assets/js/app.js"></script>

    @RenderSection("Scripts", required: false)
</body>
</html>
